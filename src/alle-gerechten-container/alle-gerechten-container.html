<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../cards/container.html">
<link rel="import" href="../toevoegen-verwijderen/gerecht-toevoegen.html">
<link rel="import" href="../toevoegen-verwijderen/gerecht-verwijderen.html">
<link rel="import" href="../toevoegen-verwijderen/melding-pop.html">

<dom-module id="alle-gerechten-container">
  <template>
    <style>
      @import '../../master.css';
      @import '../../grid.css';

      :host {
        display: block;
      }

    </style>

    <div class="container">

      <div class="row">
        <div class="8 col">

          <cards-container
            gerechten="{{alleGerechten}}"
            cta="Bestel"
            titel="Alle gerechten"
          />

        </div>

        <div class="4 col">
          <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Aspernatur amet accusamus
            laboriosam cumque dicta nobis nisi doloribus impedit quia consectetur magni magnam nemo dignissimos alias,
            ex quod nesciunt, voluptas repudiandae.</p>

          <a href="/wachtrij.html" class="btn">Bekijk wachtrij</a>

          <gerecht-toevoegen abc="{{addNewGerechtObjectToList}}" />

        </div>
      </div>

    </div>
  </template>

  <script>
    /**
     * @customElement
     * @polymer
     */

    class AlleGerechtenContainer extends Polymer.Element {
      constructor() {
        super();

        this.addNewGerechtObjectToList = this.addNewGerechtObjectToList.bind(this)
      }

      static get is() {
        return 'alle-gerechten-container';
      }

      ready() {
        super.ready();
        this.getSetLocalStorageData('GERECHTEN', this.alleGerechten)
        console.log(this.beschikbaarIngrediënten)
        this.ingrediëntenCheck()
      }

      static get properties() {
        return {
          bestellingen: {
            type: Array,
            value: [0, 2]
          },
          inBereiding: {
            type: Array,
            value: [2]
          },

          alleGerechten: {
            type: Array,
            value: [{
                id: 0,
                naam: 'Gerecht 1',
                beschrijving: 'Dit is een beschrijvin van gerecht 1',
                prijs: 4.95,
                ingredienten: ['appel', 'peer'],
                label: 'Groot',
                status: 'wordt bereidt', // een van ['', besteld', 'wordt bereidt', 'is bereidt']
                beschikbaarheid: false,
              },
              {
                id: 1,
                naam: 'Gerecht 2',
                beschrijving: 'Dit is een beschrijvin van gerecht 2',
                prijs: 12.50,
                ingredienten: ['citroen', 'perzik'],
                label: 'Groot',
                status: ' ', // een van ['besteld', 'wordt bereidt', 'is bereidt']
                beschikbaarheid: false,
              },
              {
                id: 2,
                naam: 'Gerecht 3',
                beschrijving: 'Dit is een beschrijvin van gerecht 3',
                prijs: 14.95,
                ingredienten: ['banaan', 'ei', 'kaas'],
                label: 'Klein',
                status: 'besteld', // een van ['besteld', 'wordt bereidt', 'is bereidt']
                beschikbaarheid: false,
              },
            ]
          },
          beschikbaarIngrediënten: {
            type: Object,
            value: {
              appel: true,
              kaas: true,
              Zalm: true,
              banaan: true,
              peer: true,
            }
          } 
        }
      }

      ingrediëntenCheck() {
        for (var i=0; i < this.alleGerechten.length; i++) {
              var gerecht = this.alleGerechten[i]
                console.log(gerecht)

             for (var g=0; g < gerecht.ingredienten.length; g++) {
              var ingredient = gerecht.ingredienten[g];

                if (Object.keys(this.beschikbaarIngrediënten).includes(ingredient)) {
                  console.log(gerecht.naam, 'Ja heeft: ', ingredient)
                  status = true;
                } else {
                  status = false;
                  console.log(gerecht.naam, 'Nee heeft geen: ', ingredient)
                  break;
                }
                console.log(status)
                gerecht.beschikbaarheid = status;
            }
            
        }      
      }

      

      addNewGerechtObjectToList(nieuwGerecht) {
        const toeTeVoegen = {
          ...nieuwGerecht,
          id: this.alleGerechten.length
        }

        console.log(
          'moetje vanuit alle gerechten?',
          this.alleGerechten.length,
          toeTeVoegen
        )

        this.push('alleGerechten', toeTeVoegen)

        console.log(this.alleGerechten)
        this.setLocalStorageData('GERECHTEN', this.alleGerechten)
      }

      setLocalStorageData(key, set) {
        window.localStorage.setItem(key, JSON.stringify(set))
      }

      getSetLocalStorageData(key, set) {
        const isInStorage = window.localStorage.getItem(key);
        if (isInStorage) {
          this.alleGerechten = JSON.parse(isInStorage);
          console.log('is in storage')
        } else {
          window.localStorage.setItem(key, JSON.stringify(set))
          console.log('is NIET in storage')
        }
      }
    }

    window.customElements.define(AlleGerechtenContainer.is, AlleGerechtenContainer);

  </script>
</dom-module>
